<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
        <meta name="description" />
        <meta name="keywords" content="static content generator,static site generator,static site,HTML,web development,.NET,C#,Razor,Markdown,YAML" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="/Cake.Recipe/assets/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/Cake.Recipe/assets/img/favicon.ico" type="image/x-icon">
        <title>Cake.Recipe - How to create a NuGet or Chocolatey Package</title>
        <link href="/Cake.Recipe/assets/css/highlight.css" rel="stylesheet">
        <link href="/Cake.Recipe/assets/css/bootstrap/bootstrap.css" rel="stylesheet" />
        <link href="/Cake.Recipe/assets/css/adminlte/AdminLTE.css" rel="stylesheet" />
        <link href="/Cake.Recipe/assets/css/theme/theme.css" rel="stylesheet" />
        <link href="//fonts.googleapis.com/css?family=Roboto+Mono:400,700|Roboto:400,400i,700,700i" rel="stylesheet">
        <link href="/Cake.Recipe/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="/Cake.Recipe/assets/css/override.css" rel="stylesheet" />
        <script src="/Cake.Recipe/assets/js/jquery-2.2.3.min.js"></script>
        <script src="/Cake.Recipe/assets/js/bootstrap.min.js"></script>        
        <script src="/Cake.Recipe/assets/js/app.min.js"></script>         
        <script src="/Cake.Recipe/assets/js/highlight.pack.js"></script>   
        <script src="/Cake.Recipe/assets/js/jquery.slimscroll.min.js"></script>
        <script src="/Cake.Recipe/assets/js/jquery.sticky-kit.min.js"></script>
        <script src="/Cake.Recipe/assets/js/mermaid.min.js"></script>
        <script src="/Cake.Recipe/assets/js/svg-pan-zoom.min.js"></script>
        <!--[if lt IE 9]>
        <script src="/Cake.Recipe/assets/js/html5shiv.min.js"></script>
        <script src="/Cake.Recipe/assets/js/respond.min.js"></script>
        <![endif]-->  

        
    </head>
    <body class="hold-transition wyam layout-boxed  ">    
        <div class="top-banner"></div>
        <div class="wrapper with-container">
            <!-- Header -->
            <header class="main-header">   
                     
                <a href="/Cake.Recipe/" class="logo">
                            <span>Cake.Recipe</span>
                </a>   
                         
                <nav class="navbar navbar-static-top" role="navigation">
                    <!-- Sidebar toggle button-->
                        <a href="#" class="sidebar-toggle visible-xs-block" data-toggle="offcanvas" role="button">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-right"></i>
                        </a>
                                        
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-down"></i>
                        </button>
                    </div>
            
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                        <ul class="nav navbar-nav">                            
                                    <li class="active"><a href="/Cake.Recipe/docs">Documentation</a></li>
        <li><a href="/Cake.Recipe/tasks">Tasks</a></li>
 
                        </ul>       
                    </div>
                    <!-- /.navbar-collapse -->
                
                    <!-- Navbar Right Menu -->
                </nav>
            </header>
            
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar ">
                <section class="infobar" data-spy="affix" data-offset-top="60" data-offset-bottom="200"> 
                    	
        <div><p><a href="https://github.com/cake-contrib/Cake.Recipe/tree/develop/docs/input/docs/usage/creating-packages.md"><i class="fa fa-pencil-square" aria-hidden="true"></i> Edit Content</a></p></div>
    <div id="infobar-headings"></div>

                </section>
                <section class="sidebar">    
                                     
                    

                    <ul class="sidebar-menu">
                        

                <li class="treeview">
                    <a href="/Cake.Recipe/docs/fundamentals">Fundamentals</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/Cake.Recipe/docs/fundamentals/environment-variables">Environment Variables</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/Cake.Recipe/docs/requirements">Requirements</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/Cake.Recipe/docs/requirements/posix">Posix</a></li>
                <li><a href="/Cake.Recipe/docs/requirements/windows">Windows</a></li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/Cake.Recipe/docs/usage">Usage</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/Cake.Recipe/docs/usage/getting-started-with-cake-recipe">Getting Started With Cake Recipe</a></li>
                <li><a href="/Cake.Recipe/docs/usage/conventions">A Note On Conventions</a></li>
                <li><a href="/Cake.Recipe/docs/usage/creating-release">How to create a release</a></li>
                <li class="selected"><a href="/Cake.Recipe/docs/usage/creating-packages">How to create a NuGet or Chocolatey Package</a></li>
                <li><a href="/Cake.Recipe/docs/usage/previewing-documentation">How to preview documentation</a></li>
                <li><a href="/Cake.Recipe/docs/usage/publishing-documentation">How to publish documentation</a></li>
                <li><a href="/Cake.Recipe/docs/usage/cleaning-cache">How to clean AppVeyor cache</a></li>
                <li><a href="/Cake.Recipe/docs/usage/code-coverage-reports">How to publish code coverage reports</a></li>

                    </ul>
                </li>

                    </ul>
                            
                </section>                
            </aside>
            
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                



		<section class="content-header">
			<h1>How to create a NuGet or Chocolatey Package</h1>
		</section>
	<section class="content">
		<p>This document describes how packaging works when using the <code>Cake.Recipe</code> script.</p>
<h2 id="initial-configuration">Initial Configuration</h2>
<p>You have to perform this initial configuration that it drives everything.</p>
<h2 id="environment-variables">Environment Variables</h2>
<p>If an environment variable that is defined <a href="https://cake-contrib.github.io/Cake.Recipe/docs/fundamentals/environment-variables">here</a> is set, then the corresponding task that would use that will be executed. Pretty nifty and may be something that is easily missed.</p>
<p>So for example, if I want to start publishing a MyGet package, then I would need to set the following on my build server.</p>
<pre><code>MYGET_API_KEY = &lt;your key&gt;
MYGET_SOURCE = &lt;your source&gt;
</code></pre>
<h2 id="creating-packages">Creating Packages</h2>
<p>Creating packages, either Chocolatey or NuGet, follows another set of conventions. It requires that you have those environment variables configured and that you have a specific folder structure with your NuSpec files located in those.  In the <a href="https://github.com/cake-contrib/Cake.Recipe/blob/develop/Cake.Recipe/Content/paths.cake">paths.cake</a> file, there is a class called <em>BuildPaths</em> that configures all of your build paths based on the initial project configuration that that needs to occur. In that class is the following snippet.</p>
<pre><code>var nugetNuspecDirectory = &quot;./nuspec/nuget&quot;;
var chocolateyNuspecDirectory = &quot;./nuspec/chocolatey&quot;;
</code></pre>
<p>The snippet above is looking for a <em>nuspec</em> directory at the root of your project. Inside of that directory it is looking for <em>nuget</em> and <em>chocolatey</em> directories. If those directories do not exist and/or there isn't any nuspec files located then the packaging task for that package type is skipped. Any <em>nuspec</em> files found in either directory will be harvested and a package will be generated and pushed to central package directory based on package type.</p>
<h2 id="how-it-works">How it works</h2>
<p>With that added, it will push that to MyGet. I am going to guess that you may now be wondering how does that work. If you go to the <a href="https://github.com/cake-contrib/Cake.Recipe/blob/develop/Cake.Recipe/Content/parameters.cake">parameters.cake</a> file in the repository you will notice that there is a static class called <em>BuildParameters</em>, it has a property called <em>ShouldPublishMyGet</em>. That is configured to be <em>true</em> by default, however, there is a check in that class that determines if it should be true or false.</p>
<pre><code>shouldPublishMyGet = (!IsLocalBuild &amp;&amp;
                        !IsPullRequest &amp;&amp;
                        IsMainRepository &amp;&amp;
                        (IsTagged || BuildParameters.BranchType != BranchType.Master) &amp;&amp;
                        shouldPublishMyGet);
</code></pre>
<p>Above, you can tell that it cannot be local build, pull request, not the master branch, and that it should publish to MyGet. Now the last piece of the puzzle is located in the <a href="https://github.com/cake-contrib/Cake.Recipe/blob/develop/Cake.Recipe/Content/nuget.cake">nuget.cake</a> file. That is the Cake file that contains the tasks that create and publish packages. The <em>Publish-MyGet-Packages</em> task has two criteria, that you want to publish a MyGet package and that packages have actually been created. This task also contains the check for the environment variables we set above and will record that error and continue to execute the next task.</p>
<p>Finally, the packages from each package directory will be harvested and all packages found will be pushed to their respective feeds.</p>

	</section>
                
            </div>           
            
            <!-- Footer -->
            <footer class="main-footer">
            </footer>
            
        </div>
        <div class="wrapper bottom-wrapper">
            <footer class="bottom-footer">
                Generated by <a href="https://wyam.io">Wyam</a>
            </footer>
        </div>
        <a href="javascript:" id="return-to-top"><i class="fa fa-chevron-up"></i></a>
        
        <script>           
            // Close the sidebar if we select an anchor link
            $(".main-sidebar a[href^='#']:not('.expand')").click(function(){
                $(document.body).removeClass('sidebar-open');
            });
            
            $(document).ready(function() {
                mermaid.initialize(
                {
                    flowchart:
                    {
                        useMaxWidth: false
                    },
					startOnLoad: false,
					cloneCssStyles: false
                });     
                mermaid.init(undefined, ".mermaid");

                // Remove the max-width setting that Mermaid sets
                var mermaidSvg = $('.mermaid svg');
                mermaidSvg.addClass('img-responsive');
                mermaidSvg.css('max-width', '');

                // Make it scrollable
				var target = document.querySelector(".mermaid svg");
				if(target !== null)
				{
					var panZoom = window.panZoom = svgPanZoom(target, {
						zoomEnabled: true,
						controlIconsEnabled: true,
						fit: true,
						center: true,
                        maxZoom: 20,
                        zoomScaleSensitivity: 0.6
					});			                          

                    // Do the reset once right away to fit the diagram
                    panZoom.resize();
                    panZoom.fit();
                    panZoom.center();
                    
                    $(window).resize(function(){
                        panZoom.resize();
                        panZoom.fit();
                        panZoom.center();
                    });
				}
                
                $('pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });  
            });

            hljs.initHighlightingOnLoad();

            // Back to top
            $(window).scroll(function() {
                if ($(this).scrollTop() >= 200) {        // If page is scrolled more than 50px
                    $('#return-to-top').fadeIn(1000);    // Fade in the arrow
                } else {
                    $('#return-to-top').fadeOut(1000);   // Else fade out the arrow
                }
            });
            $('#return-to-top').click(function() {      // When arrow is clicked
                $('body,html').animate({
                    scrollTop : 0                       // Scroll to top of body
                }, 500);
            });
        </script>
    </body>
</html>